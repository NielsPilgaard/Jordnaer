@page "/"
@using Microsoft.AspNetCore.OutputCaching
@using Jordnaer.Features.Dashboard

@inject IBrowserViewportService BrowserViewportService

@attribute [OutputCache(Duration = 31536000)] // 1 year caching for landing page
@attribute [Sitemap]

<MetadataComponent Title="Mini Møder" Description="Et online mødested for børnefamilier" />

<style>
    /* Remove container constraints for full-width landing page */
    #main-content {
        padding: 0 !important;
        margin: 0 !important;
    }

    #main-container {
        padding: 0 !important;
        margin: 0 !important;
        max-width: none !important;
    }
</style>

<AuthorizeView>
    <Authorized>
        @* Authenticated users see the dashboard *@
        <UserDashboard />
    </Authorized>
    <NotAuthorized>
        @* Guest users see the landing page *@
        @if (_isMobile)
        {
            <MobileLandingPage />
        }
        else
        {
            <DesktopLandingPage />
        }
    </NotAuthorized>
</AuthorizeView>

@code
{
    private bool _isMobile = false;
    private readonly Guid _breakpointObserverId = Guid.NewGuid();

    protected override async Task OnInitializedAsync()
    {
        await BrowserViewportService.SubscribeAsync(
        observerId: _breakpointObserverId,
        lambda: async args =>
        {
            var isMobile = args.Breakpoint <= Breakpoint.Sm;
            if (isMobile != _isMobile)
            {
                _isMobile = isMobile;
                await InvokeAsync(StateHasChanged);
            }
        },
        fireImmediately: true);
    }
}