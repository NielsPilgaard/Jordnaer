@inject IPartnerService PartnerService

<MudLink Href="@Link" Target="_blank" Underline="Underline.None" OnClick="HandleClickAsync"
    UserAttributes="@(new Dictionary<string, object> { { "rel", "noopener" } })">
    <div class="image-ad-wrapper">
        <div class="image-with-label">
            <MudImage Src="@ImagePath" Alt="@ImageAlt" Class="ad-image"
                Style="width: 100%; height: auto; border-radius: 8px;" loading="lazy" />
            <div class="image-ad-label">Annonce</div>
        </div>
    </div>
</MudLink>

@code {
    [Parameter, EditorRequired]
    public required string Link { get; set; }

    [Parameter, EditorRequired]
    public required string ImagePath { get; set; }

    [Parameter, EditorRequired]
    public required string ImageAlt { get; set; }

    [Parameter]
    public bool IsPreview { get; set; } = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !IsPreview)
        {
            JordnaerMetrics.AdViewCounter.Add(1, new KeyValuePair<string, object?>("link", Link));

            // TODO: Replace Guid.Empty with actual partner ID when migrating from hardcoded ads
            // See tasks/02-migrate-hardcoded-ads-to-partner-system.md
            await PartnerService.RecordImpressionAsync(Guid.Empty);
        }
    }

    private async Task HandleClickAsync()
    {
        if (!IsPreview)
        {
            // TODO: Replace Guid.Empty with actual partner ID when migrating from hardcoded ads
            // See tasks/02-migrate-hardcoded-ads-to-partner-system.md
            await PartnerService.RecordClickAsync(Guid.Empty);
        }
    }
}