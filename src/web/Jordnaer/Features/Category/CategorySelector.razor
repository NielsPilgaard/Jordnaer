@inject ICategoryCache CategoryCache

<style>
    .category-chip-selected {
        background-color: var(--mud-palette-success) !important;
        color: white !important;
    }

    .category-chip-unselected {
        background-color: #6b7280 !important;
        color: white !important;
    }

    .category-chip-unselected:hover {
        background-color: #4b5563 !important;
    }
</style>

<MudChipSet T="string" Style="display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;"
    SelectionMode="SelectionMode.MultiSelection" SelectedValues="Categories" CheckMark
    SelectedValuesChanged="SelectedCategoriesChanged">
    @foreach (var category in _allCategories)
    {
        var isSelected = Categories?.Contains(category) == true;
        <MudChip Text="@category" Value="@category" Variant="Variant.Filled"
            Color="@(isSelected ? Color.Success : Color.Info)"
            Size="Size.Medium"
            Class="@(isSelected ? "category-chip-selected" : "category-chip-unselected")" />
    }

</MudChipSet>
@code
{
    private List<string> _allCategories = [];

    [Parameter]
    public string[]? Categories { get; set; }

    [Parameter]
    public EventCallback<string[]?> CategoriesChanged { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var cachedCategories = await CategoryCache.GetOrCreateCategoriesAsync();
        _allCategories = cachedCategories.Select(x => x.Name).ToList();
    }

    private async Task SelectedCategoriesChanged(IEnumerable<string?>? categories)
    {
        Categories = (categories is null
        ? []
        : categories.Where(x => x != null).ToArray())!;

        await CategoriesChanged.InvokeAsync(Categories);
    }
}