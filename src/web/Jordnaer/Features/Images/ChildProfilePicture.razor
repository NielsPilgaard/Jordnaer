@using Jordnaer.Shared
@inject IProfileImageService ProfileImageService

<ProfilePictureUpload
    CurrentProfilePictureUrl="@ChildProfile.ProfilePictureUrl"
    DisplayName="@($"{ChildProfile.FirstName} {ChildProfile.LastName}")"
    DisplayInitial="@(ChildProfile.FirstName?.FirstOrDefault() ?? '?')"
    ProfilePictureAltText="@(string.IsNullOrEmpty(ChildProfile.FirstName) ? "Billede af barn" : $"Billede af {ChildProfile.FirstName}")"
    OnSave="SaveChildProfilePicture"
    OnImageChanged="OnImageChanged" />

@code {
    [Parameter]
    public required ChildProfile ChildProfile { get; set; }

    [Parameter]
    public required EventCallback<ChildProfile> ChildProfileChanged { get; set; }

    private async Task<string> SaveChildProfilePicture(byte[] imageBytes)
    {
        var uri = await ProfileImageService.SetChildProfilePictureAsync(new SetChildProfilePicture(ChildProfile, imageBytes));
        ChildProfile.ProfilePictureUrl = uri;
        return uri;
    }

    private async Task OnImageChanged()
    {
        await ChildProfileChanged.InvokeAsync(ChildProfile);
    }
}
