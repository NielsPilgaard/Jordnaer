@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor

<MudFileUpload T="IBrowserFile"
               Accept="image/jpeg, image/png"
               OnFilesChanged="OnFilesChanged"
               MaximumFileCount="1"
               Hidden="false"
               title="Klik her for at skifte billede"
               InputClass="absolute mud-height-full overflow-hidden z-20"
               InputStyle="opacity:0;cursor: pointer"
               @ref="_fileUpload">
    <ActivatorContent>
        <MudPaper Elevation="4" Class="rounded-circle d-flex align-center justify-center overflow-hidden"
                  Style="width: 200px; height: 200px;">
            @if (!string.IsNullOrEmpty(CurrentProfilePictureUrl))
            {
                <MudImage ObjectPosition="ObjectPosition.Center" ObjectFit="ObjectFit.Cover"
                          Style="width: 100%; height: 100%;" Src="@CurrentProfilePictureUrl"
                          Alt="@ProfilePictureAltText" />
            }
            else
            {
                <MudAvatar Style="width: 100%; height: 100%; font-size: 3rem;" Color="Color.Primary">
                    @DisplayInitial
                </MudAvatar>
            }
        </MudPaper>
    </ActivatorContent>
</MudFileUpload>

<MudExpansionPanels Class="mt-4">
    <MudExpansionPanel Text="Vejledning til upload af billede" Dense="true">
        <MudText Typo="Typo.body2" Class="mb-2">
            <strong>Anbefalede billedkrav:</strong>
        </MudText>
        <MudList T="string" Dense="true" ReadOnly>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Image">
                <strong>Størrelse:</strong> Mindst 400x400 px for bedste kvalitet
            </MudListItem>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Photo">
                <strong>Format:</strong> JPEG eller PNG
            </MudListItem>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Storage">
                <strong>Maks filstørrelse:</strong> 2 MB
            </MudListItem>
        </MudList>
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    [Parameter]
    public string? CurrentProfilePictureUrl { get; set; }

    [Parameter]
    public char DisplayInitial { get; set; } = '?';

    [Parameter]
    public string ProfilePictureAltText { get; set; } = "Profilbillede";

    [Parameter]
    public EventCallback<InputFileChangeEventArgs> OnFilesChanged { get; set; }

    private MudFileUpload<IBrowserFile>? _fileUpload;
}
