@using Jordnaer.Models
@using Jordnaer.Shared
@inject IProfileImageService ProfileImageService

<ProfilePictureUpload
    CurrentProfilePictureUrl="@UserProfile.ProfilePictureUrl"
    DisplayName="@UserProfile.DisplayName"
    DisplayInitial="@(string.IsNullOrWhiteSpace(UserProfile.FirstName) ? '?' : UserProfile.FirstName[0])"
    ProfilePictureAltText="@(string.IsNullOrEmpty(UserProfile.FirstName) ? "Avatar" : $"Billede af {UserProfile.FirstName}")"
    OnSave="SaveUserProfilePicture"
    OnImageChanged="OnImageChanged" />

@code {
    [Parameter]
    public required UserProfile UserProfile { get; set; }

    [Parameter]
    public required EventCallback<UserProfile> UserProfileChanged { get; set; }

    private async Task<string> SaveUserProfilePicture(byte[] imageBytes)
    {
        var uri = await ProfileImageService.SetUserProfilePictureAsync(new SetUserProfilePicture(UserProfile, imageBytes));
        UserProfile.ProfilePictureUrl = uri;
        return uri;
    }

    private async Task OnImageChanged()
    {
        await UserProfileChanged.InvokeAsync(UserProfile);
    }
}
