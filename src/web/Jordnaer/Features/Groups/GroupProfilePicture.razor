@using Jordnaer.Shared
@inject IProfileImageService ProfileImageService

<ProfilePictureUpload
    CurrentProfilePictureUrl="@(Group.ProfilePictureUrl ?? ProfileConstants.Default_Profile_Picture)"
    DisplayName="@Group.Name"
    DisplayInitial="@(Group.Name?.FirstOrDefault() ?? '?')"
    ProfilePictureAltText="@(string.IsNullOrEmpty(Group.Name) ? "Profil billede" : $"{Group.Name}'s profil billede")"
    OnSave="SaveGroupProfilePicture"
    OnImageChanged="OnImageChanged" />

@code {
    [Parameter]
    public required Group Group { get; set; }

    [Parameter]
    public required EventCallback<Group> GroupChanged { get; set; }

    private async Task<string> SaveGroupProfilePicture(byte[] imageBytes)
    {
        var uri = await ProfileImageService.SetGroupProfilePictureAsync(new SetGroupProfilePicture(Group, imageBytes));
        Group.ProfilePictureUrl = uri;
        return uri;
    }

    private async Task OnImageChanged()
    {
        await GroupChanged.InvokeAsync(Group);
    }
}
